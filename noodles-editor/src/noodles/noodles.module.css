/*
 * Noodles.gl Component Styles
 *
 * This file contains component-specific styles for the node-based editor.
 *
 * CSS Architecture:
 * - Vendor CSS is imported via layers.css and placed in the 'vendors' layer
 * - Critical overrides below are UNLAYERED (not in any @layer)
 * - Unlayered styles have highest priority and will override layered styles
 * - This approach makes styling robust against import order changes
 *
 * Note: The !important declarations ensure these overrides work reliably
 * even when vendor libraries update their styles or specificity.
 */

:root {
  color-scheme: dark !important;

  /* Generic UI colors - used throughout the interface */
  --color-bg-base: #1a1a1a;
  --color-bg-primary: #282b2fde;
  --color-bg-secondary: #2a2a2a;
  --color-bg-hover: rgba(255, 255, 255, 0.1);
  --color-bg-active: rgba(255, 255, 255, 0.15);
  --color-bg-accent: rgba(255, 255, 255, 0.15);

  --color-text-primary: #e2dede;
  --color-text-secondary: #888;
  --color-text-disabled: #555;
  --color-text-accent: #4a9eff;

  --color-border: #333;
  --color-border-hover: #555;
  --color-border-focus: rgba(255, 255, 255, 0.2);

  --color-input-hover: #383838;
  --color-input-focus: #2d2d2d;
  --color-input-disabled: #1c1c1c;

  --color-selected: #3367d9;

  /* Node type colors */
  --node-string-color: #1299be;
  --node-number-color: #bc1212;
  --node-boolean-color: #c69a16;
  --node-code-color: #493590;
  --node-color-color: #c9750e;
  --node-data-color: #0f892f;
  --node-geojson-color: #22c55e;
  --node-layer-color: #c90ec6;
  --node-effect-color: #0044ff;
  --node-extension-color: #16a34a;
  --node-compound-color: #18a24b;
  --node-grouping-color: #000000;
  --node-deck-color: #303846;
  --node-utility-color: #cfca35;
  --node-vector-color: #610d4e;
  --node-view-color: #0e8fc9;
  --node-widget-color: #7a61d5;

  --property-panel-width: 280px;
  --property-panel-background-color: #282b2fcc;
  --tooltip-icon-color: #919191;
  --tooltip-background-color: #383838;

  --xy-controls-button-color: #383838;
  --xy-controls-button-color-hover: #262626;

  --z-index-for-loop: -99;
  --z-index-tooltip-container: 101;
  --z-index-react-flow: 999;
  --z-index-breadcrumbs: 1000;
  --z-index-menu: 10000;
  --z-index-viewer-preview: 9999;
  --z-index-step-ladder: 10001;
}

/**
 * Apply this class anywhere you need to bypass the global CSS reset
 * Should be added first for proper cascade order
 */
:global(.revert) {
  all: revert !important;
}

:global(.react-flow) {
  --node-group-background-color: rgba(244, 79, 9, 0.1);

  /* Node-specific aliases (use generic colors) */
  --node-background-color: var(--color-bg-primary);
  --node-text-color: var(--color-text-primary);
  --node-selected-color: var(--color-selected);
  --node-add-menu-header-text-color: var(--color-text-primary);
  --node-header-text-color: #dadada;
  --node-header-text-color-dark: #292929;
  --node-header-border-color: #e0e0e0;
  --node-input-hover-color: var(--color-input-hover);
  --node-input-focus-color: var(--color-input-focus);
  --node-input-disaabled-color: var(--color-input-disabled);

  --node-add-menu-background-color: #404040;
  --node-add-menu-header-background-color: black;
  --node-add-menu-hover-color: #313131;

  --node-handle-outline-color: #808080;

  --node-field-hint-color: #808080;

  /* Execution state indicators */
  --node-execution-executing-color: #3b82f6;
  --node-execution-error-color: #ef4444;
  --node-execution-slow-color: #f59e0b;

  --node-drop-target-text-color: #fff;
}

:global(.react-flow-wrapper) {
  z-index: var(--z-index-react-flow) !important;
  width: 100% !important;
  height: 100% !important;
}

:global(.react-flow-wrapper-hidden) {
  display: none !important;
}

:global(.react-flow__node) {
  color: var(--node-text-color) !important;
  background: var(--node-background-color) !important;
  border-radius: 10px !important;
}

:global(.react-flow__handle) {
  border-color: var(--node-handle-outline-color) !important;
  height: 8px !important;
  width: 8px !important;
}

:global(.react-flow__handle-left) {
  left: -3px !important;
}

:global(.react-flow__resize-control.line) {
  /* Hide the border on resizable nodes. Overrides React Flow class */
  border-width: 0 !important;
}

:global(.react-flow__node.selectable:focus) {
  outline: 1px solid var(--node-selected-color) !important;
}

:global(.react-flow__node-group) {
  background-color: var(--node-group-background-color) !important;
  /* Allow nodes to be selected over the ForLoopBody. Needs to override the style prop */
  z-index: var(--z-index-for-loop) !important;
  pointer-events: none !important;
}

:global(.deck-widget-icon-button) {
  all: revert !important;
}

.header {
  border-radius: 10px 10px 0 0;
  border-color: var(--node-header-border-color);
  color: var(--node-header-text-color);
  font-weight: bold;
  margin-bottom: 0.5em;
  padding: .25em .75em .25em 1em;


  display: flex;
  justify-content: space-between;
  align-items: center;
}

.headerTitle {
  width: 100%;
  max-width: 300px;
  text-overflow: ellipsis;
  text-wrap: nowrap;
  overflow: hidden;
  white-space: nowrap;
}

.headerId {
  width: 100px;
}

.headerIdInput {
  background-color: rgba(0, 0, 0, .2);
}

.headerIdInputError {
  border: 2px solid #ff4444;
  background-color: rgba(255, 68, 68, 0.1);
}

/* Radix Tooltip */
.tooltipArrow {
  fill: var(--tooltip-background-color);
}

.headerActions {
  display: flex;
  gap: 5px;
  color: var(--node-header-text-color);
  align-items: center;
}

.headerLock {
  font-size: 10px;
  padding: 0;
  width: 22px;
  height: 22px;
}

.headerLockLocked {
  filter: brightness(0.5);
}

.headerDownload {
  font-size: 10px;
  padding: 0;
  width: 22px;
  height: 22px;
}

/* Header background colors */

.headerNumber {
  background-color: var(--node-number-color);
}

.headerString {
  background-color: var(--node-string-color);
}

.headerBoolean {
  background-color: var(--node-boolean-color);
}

.headerColor {
  background-color: var(--node-color-color);
}

.headerCode {
  background-color: var(--node-code-color);
}

.headerData {
  background-color: var(--node-data-color);
}

.headerGeojson {
  background-color: var(--node-geojson-color);
  color: var(--node-header-text-color-dark);
}

.headerLayer {
  background-color: var(--node-layer-color);
}

.headerExtension {
  background-color: var(--node-extension-color);
}

.headerCompound {
  background-color: var(--node-compound-color);
}

.headerEffect {
  background-color: var(--node-effect-color);
}

.headerDeck {
  background-color: var(--node-deck-color);
}

.headerGrouping {
  background-color: var(--node-grouping-color);
}

.headerUtility {
  background-color: var(--node-utility-color);
  color: var(--node-header-text-color-dark);
}

.headerVector {
  background-color: var(--node-vector-color);
}

.headerView {
  background-color: var(--node-view-color);
}

.headerWidget {
  background-color: var(--node-widget-color);
}

/* Handle sizes */
.handleList {
  height: .75em !important;
  border-radius: 5px !important
}

/* Handle colors */

.handleNumber {
  --xy-handle-background-color: var(--node-number-color);
  background-color: var(--node-number-color);
}

.handleString {
  --xy-handle-background-color: var(--node-string-color);
  background-color: var(--node-string-color);
}

.handleBoolean {
  color: var(--node-header-text-color-dark);
  --xy-handle-background-color: var(--node-boolean-color);
  background-color: var(--node-boolean-color);
}

.handleColor {
  --xy-handle-background-color: var(--node-color-color);
  background-color: var(--node-color-color);
}

.handleData {
  --xy-handle-background-color: var(--node-data-color);
  background-color: var(--node-data-color);
}

.handleGeojson {
  --xy-handle-background-color: var(--node-geojson-color);
  background-color: var(--node-geojson-color);
}

.handleVector {
  --xy-handle-background-color: var(--node-vector-color);
  background-color: var(--node-vector-color);
}

.handleCompound {
  --xy-handle-background-color: var(--node-compound-color);
  background-color: var(--node-compound-color);
}

.handleView {
  --xy-handle-background-color: var(--node-view-color);
  background-color: var(--node-view-color);
}

.handleLayer {
  --xy-handle-background-color: var(--node-layer-color);
  background-color: var(--node-layer-color);
}

.handleEffect {
  --xy-handle-background-color: var(--node-effect-color);
  background-color: var(--node-effect-color);
}

.handleExtension {
  --xy-handle-background-color: var(--node-extension-color);
  background-color: var(--node-extension-color);
}

.handleWidget {
  --xy-handle-background-color: var(--node-widget-color);
  background-color: var(--node-widget-color);
}

.content {
  position: relative;
  margin-bottom: 1em;
  padding: 0 1em;
  cursor: auto;
  height: 100%;
  display: flex;
  flex-direction: column;
  min-height: inherit;
}

/* Field components */
.fieldWrapper {
  display: flex;
  justify-content: space-between;
  align-items: center;
  min-height: 25px;
  gap: 10px;
}

.fieldLabel {
  flex: 1;
}

.compoundPropsExpander {
  display: inline-block;
  cursor: pointer;
  margin-left: 3px;
  font-size: 10px;
  transition: transform 0.2s linear;
  transform: rotate(0deg);
}

.compoundPropsExpanderExpanded {
  transform: rotate(90deg);
}

.fieldInputWrapper {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  flex: 2;
}

.fieldInput {
  border: none;
  text-align: right;
  flex: 1;
  background: transparent;
  color: var(--node-text-color);
}

.fieldInput:hover {
  background: var(--node-input-hover-color);
}

.fieldInput:focus {
  outline: none;
  background: var(--node-input-focus-color);
}

.fieldInput:disabled {
  background: var(--node-input-disaabled-color);
}

.fieldInputGroup {
  gap: 8px;
}

.fieldInputGroup:hover {
  background: var(--node-input-hover-color);
}

.fieldInputGroup:focus-within {
  background: var(--node-input-focus-color);
}

.fieldInputUploadButton {
  cursor: pointer;
  height: 1em;
}

.fieldCompoundWrapper {
  flex: 1;
  margin-left: 10px;
}

/* Field specific */
:global(.react-flow__node-CodeOp) {
  min-width: 425px;
  min-height: 170px;
}

.fieldWrapperCode {
  flex: 1;
  width: 100%;
  height: 100%;
  min-width: 400px;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  position: relative;
}

.fieldInputWrapperCodeEditor {
  display: block;
  min-height: 100px;
  width: 100%;
  position: absolute;
  inset: 0;
}

.fieldInputNumber {
  margin-right: -12px;
  cursor: ew-resize;
  user-select: none;
}

.fieldInputNumber:focus {
  outline: none;
  background: var(--node-input-focus-color);
  cursor: text;
}

.fieldInputNumber:not(:focus):hover {
  background: var(--node-input-hover-color);
}

.fieldInputNumber:disabled {
  background: var(--node-input-disabled-color);
  cursor: not-allowed;
}

.fieldInputNumberDragging {
  background: var(--node-input-focus-color);
  cursor: grabbing;
  user-select: none;
  caret-color: transparent;
}

.fieldLabelVector {
  width: 10px;
  color: var(--node-field-hint-color);
}

.fieldInputWrapperVector {
  display: flex;
  gap: 5px;
}

.fieldInputVector {
  width: 50px;
}

.fieldLookupButton {
  margin-left: 4px;
  padding: 0 !important;
  width: 24px !important;
  height: 24px !important;
  min-width: 24px !important;
  flex-shrink: 0;
}

.fieldInputUpload {
  cursor: pointer;
}

.fieldInputCheckbox {
  flex: unset;
  cursor: pointer;
}

.fieldInputColor {
  height: 25px;
  max-width: 32px;
  border: none;
}

/* Color swatch button - Simple Chrome-style with checkered background */
.colorSwatch {
  width: 32px;
  height: 24px;
  padding: 2px;
  border: 1px solid #808080;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  background-color: #1a1a1a;
}

.colorSwatch:hover:not(:disabled) {
  border-color: #999999;
}

.colorSwatch:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Checkered background pattern layer - sits behind the color */
.colorSwatchInner {
  width: 100%;
  height: 100%;
  border-radius: 1px;
  position: relative;
  background-image:
    linear-gradient(45deg, #808080 25%, transparent 25%),
    linear-gradient(-45deg, #808080 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, #808080 75%),
    linear-gradient(-45deg, transparent 75%, #808080 75%);
  background-size: 8px 8px;
  background-position: 0 0, 0 4px, 4px -4px, -4px 0px;
  background-color: #404040;
}

/* Color overlay - sits on top of checkered pattern */
.colorSwatchInner::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 1px;
  background-color: var(--color-value);
}

/* Dark mode ChromePicker wrapper */
.chromePickerWrapper {
  /* Override react-color's ChromePicker styles for dark mode */
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5));
}

.chromePickerWrapper :global(.chrome-picker) {
  background: #282b2f !important;
  border-radius: 4px !important;
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1) !important;
}

.chromePickerWrapper :global(.chrome-picker input) {
  background: #1a1a1a !important;
  color: #e2dede !important;
  border: 1px solid #333 !important;
  box-shadow: none !important;
}

.chromePickerWrapper :global(.chrome-picker label) {
  color: #888 !important;
}

.chromePickerWrapper :global(.chrome-picker .flexbox-fix:last-child) {
  /* Color input fields container */
  background: transparent !important;
}

.chromePickerWrapper :global(.chrome-picker .flexbox-fix:last-child > div) {
  /* Individual input wrappers */
  background: transparent !important;
}

.chromePickerWrapper :global(.chrome-picker svg) {
  /* Color model picker icon (RGB/HSL/HEX toggle) */
  fill: #e2dede !important;
}

.chromePickerWrapper :global(.chrome-picker path) {
  /* SVG paths in the color model picker icon */
  fill: #e2dede !important;
}

.fieldInputColorRamp {
  background-color: white;
  image-rendering: -moz-crisp-edges;
  image-rendering: pixelated;

  width: 200px;
  height: 40px;
}

.fieldInputSelect {
  border: none;
  background: transparent;
  color: var(--node-text-color);
  text-align: right;
}

.nodeFieldWrapper {
  display: flex;
}

.fieldFileInputGroup {
  width: unset;
}

.fieldInputFileUrl {
  padding: 0 1em;
}

.fieldInputButton {
  background: var(--node-background-color);
  border: 1px solid var(--node-text-color);
  color: var(--node-text-color);
  cursor: pointer;
  font-size: 1em;
  padding: 0.5em;
  margin: 0.5em 0;
}

.stepLadder {
  position: absolute;
  display: flex;
  flex-direction: column;
  background: var(--node-background-color);
  border: 1px solid var(--node-handle-outline-color);
  border-radius: 2px;
  padding: 4px 2px;
  z-index: var(--z-index-step-ladder);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  min-width: 60px;
  pointer-events: none;
}

.stepLadderItem {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 3px 6px;
  font-size: 11px;
  font-family: 'Courier New', monospace;
  color: var(--node-field-hint-color);
  border-radius: 1px;
  transition: all 0.1s ease;
  cursor: default;
  margin: 1px 0;
}

.stepLadderItemActive {
  background-color: var(--node-selected-color);
  color: white;
  font-weight: bold;
  transform: scale(1.1);
  box-shadow: 0 0 4px rgba(51, 103, 217, 0.4);
  border: 1px solid rgba(51, 103, 217, 0.6);
}

.stepLadderLabel {
  white-space: nowrap;
  text-align: center;
}

.referenceEdge {
  stroke-dasharray: 5 5;
  stroke-width: 1.5;
  pointer-events: none;
  stroke: #888;
}

/* Mapbox geocoder */
:global(.mapboxgl-ctrl-geocoder--input) {
  min-width: 200px;
  color: var(--node-text-color);
}

:global(.mapboxgl-ctrl-geocoder--input:focus) {
  color: var(--node-text-color);
  outline: none;
}

:global(.mapboxgl-ctrl-geocoder),
:global(.mapboxgl-ctrl-geocoder--button),
:global(.mapboxgl-ctrl-geocoder .suggestions),
:global(.mapboxgl-ctrl-geocoder--suggestion),
:global(.mapboxgl-ctrl-geocoder .suggestions > .active > a),
:global(.mapboxgl-ctrl-geocoder .suggestions > li > a:hover) {
  background: var(--node-background-color);
  color: var(--node-text-color);
}

/* Node add menu */
.addNodeMenu {
  background: var(--node-add-menu-background-color);
  height: 300px;
  width: 260px;
  padding-bottom: 1em;
  position: absolute;
  z-index: var(--z-index-menu);
  overflow: auto;
  border-radius: 8px;
}

.addNodeMenuHeader {
  font-weight: bold;
  padding: .5em;
  background: var(--node-add-menu-header-background-color);
  color: var(--node-add-menu-header-text-color);
  position: sticky;
  top: 0;
  width: 100%;
}

.addNodeMenuItem {
  cursor: pointer;
  padding: 0.5em;
  line-height: 140%;
}

.addNodeItemHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.nodeCategoryCapsule {
  height: 16px;
  line-height: 16px;
  padding: 0 8px;
  border-radius: 16px;
  font-size: 12px;
  font-weight: 500;
}

.addNodeItemDescription {
  margin-top: 4px;
  font-size: 12px;
  font-weight: 500;
  color: var(--surface-600);
  line-height: 140%;
}

.addNodeMenuItem:hover {
  background: var(--node-add-menu-hover-color);
}

.addNodeSearchBox {
  background: var(--node-add-menu-background-color);
  padding: 0.5em;
  border: none;
  outline: none;
  position: sticky;
  top: 35px;
  width: 100%;
}

.projectNameBar {
  display: flex;
  padding: 3px;
  margin: 8px;
  justify-content: center;
}

.rightPanel {
  display: flex;
  flex-direction: column;
  flex: 1;
  height: 100%;
  overflow: auto;
}

.executionIndicator {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-left: 8px;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  font-size: 10px;
  opacity: 0.9;
}

.executionIndicatorExecuting {
  color: var(--node-execution-executing-color);
  animation: pulse 1.5s ease-in-out infinite;
}

.executionIndicatorError {
  color: var(--node-execution-error-color);
  background-color: rgba(239, 68, 68, 0.1);
}

.executionIndicatorSlow {
  color: var(--node-execution-slow-color);
  background-color: rgba(245, 158, 11, 0.1);
}

@keyframes pulse {

  0%,
  100% {
    opacity: 0.6;
  }

  50% {
    opacity: 1;
  }
}

.wrapper {}

.wrapperError {
  box-shadow: 0 0 0 1px var(--node-execution-error-color);
}

.wrapperExecuting {
  box-shadow: 0 0 0 1px var(--node-execution-executing-color);
}

.outputHandleContainer {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  justify-content: space-evenly;
  pointer-events: none;
}
